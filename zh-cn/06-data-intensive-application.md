# 数据密集型应用

> 作者: 潘深练
>
> 创建: 2022-04-19


## 一、数据密集型应用

当今许多新型应用都属于数据密集型（data-intensive），而不是计算密集型（compute-intensive）。对于数据密集型应用，CPU 的处理能力往往不是第一限制性因素，关键在于：

- 数据量
- 数据的复杂度
- 数据的快速多变性

数据密集型应用通常也是基于标准模块构建而成，每个模块负责单一的常用功能。例如，许多应用系统都包含以下模块（或称为数据处理系统，data system）：

- 数据库：用以存储数据，这样之后应用可以再次访问
- 高速缓存：缓存那些复杂或操作代价昂贵的结果，以加快下一次访问
- 索引：用户可以按关键字搜索数据并支持各种过滤
- 流式处理：持续发送消息至另一个进程，处理采用异步方式
- 批处理：定期处理大量的累积数据

## 二、认识数据系统

### 1、趋势

我们通常将数据库、队列、高速缓存等视为不同类型的系统。虽然数据库和消息队列存在某些相似性，例如两者都会保存数据（至少一段时间），但他们却有着截然不同的访问模式，这就意味着不同的性能特征和设计实现。

- 首先，近年来出现了许多用于数据存储和处理的新工具。它们针对各种不同的应用场景进行优化，不适合再归为传统类型。例如，Redis 既可以用于数据存储也适用于 **消息队列**，Apache Kafka 作为消息队列也具备了持久化存储保证。系统之间的界限正在变得模糊。
- 其次，越来越多的应用系统需求广泛，单个组件往往无法满足所有数据处理与存储需求。因而需要将任务分解，每个组件负责高效完成的一部分，多个组件依靠应用层代码驱动有机衔接起来。

### 2、问题

设计数据系统或数据服务时，一定会碰到很多棘手的问题。例如：

- 当系统内出现了局部失效时，如何确保数据的正确性与完整性？
- 当发生系统降级（degrade）时，该如何为客户提供一致的良好表现？
- 当负载增加时，系统如何扩展？
- 友好的服务 API 该如何设计？

影响数据系统设计的因素有很多，其中包括相关人员技能和经验水平、遗留系统依赖性、交付周期、对不同风险因素的容忍度、监管合规等。这些因素往往因时因地而异。

一个应用必须完成预期的多种需求，主要包括:
- 功能性需求（即应该做什么，比如各种存储、检索、搜索和处理数据）
- 非功能性需求（即常规性、例如安全性、可靠性、合规性、可伸缩性、兼容性和可维护性）。其中极为重要的 [三个问题](/zh-cn/06-architecture-target?id=二、分布式是架构设计挑战)：
    - 可靠性
    - 扩展性（可伸缩性）
    - 可维护性

## 三、数据模型与查询语言

### 1、数据模型

数据模型可能是开发软件最重要的部分，它们不仅对软件的编写方式，而且还对如何思考待解决的问题都有深远的影响。

大多数应用程序是通过一层一层 **叠加数据模型** 来构建的。每一层都面临的关键问题是：**如何将其用下一层来表示？**

1）、作为一名应用程序开发人员，观测现实世界（其中包括人员、组织、货物、行为、资金流动、传感器等），通过对象或数据结构，以及操作这些数据结构的 API 来对其建模。这些数据结构往往特定于该应用。

2）、当需要存储这些数据结构时，可以采用通用数据模型（例如 JSON 或 XML 文档、关系数据库中的表或图模型）来表示。

3）、数据库工程师接着决定用何种内存、磁盘或网络的字节格式来表示上述 JSON/XML/关系/图形数据。数据表示需要支持多种方式的查询、搜索、操作和处理数据。

4）、在更下一层，硬件工程师则需要考虑用电流、光脉冲、磁场等来表示字节。

复杂的应用程序可能会有更多的中间层，例如基于 API 来构建上层 API，但是基本思想相同：每层都通过提供一个简洁的数据模型来隐藏下层的 **复杂性**。这些 **抽象** 机制使得不同的人群可以高效协作，例如数据厂商的工程师和使用数据库的应用程序开发人员一起合作。

#### 1.1、关系模型

现在最著名的数据模型可能是 SQL，多年来在数据存储和查询方面主宰了市场。在 20 世纪 70 年代和 80 年代初期，网络模型和层次模型是两个主要的选择，但最终关系模型主宰了这个领域。对象数据库曾在 20 世纪 80 年代后期和 90 年代初期起起伏伏。XML 数据库则出现在 21 世纪初，但也仅限于利基市场。关系模型的每个竞争者都曾聒噪一时，可惜无一持久。

随着计算机变得越来越强大和网络化，服务目的日益多样化。值得注意的是，关系数据库超出了它们最初的商业数据处理范围，顺利推广到了各种各样的用例。当前在网络上看到的大部分内容，很多仍然是有关系数据库所支撑的，无论是在线发布、论坛、社交网络、电子商务、游戏、SAAS等。

层次模型与网络模型，在实际数据应用场景中，会异常复杂而没有灵活性。而相比之下，关系模型所做的则是定义了所有数据的格式：**关系（表）** 只是 **元组（行）** 的集合，仅此而已，不像层次模型与网络模型，没有复杂的嵌套结构，也没有复杂的访问路径。

在关系数据库中，**查询优化器** 自动决定以何种顺序执行查询，以及使用哪些 **索引**。实际上就是查询优化器自动生成了 “访问路径”。

**NoSQL**

NoSQL （不仅仅是SQL）成为推翻关系模式主导地位的又一个竞争者。采用 NoSQL 数据库有这样几个驱动因素，包括：

- 比关系数据库更好的 **扩展性** 需求，包括支持大数据集或超高写入吞吐量。
- 普遍偏爱 **免费和开源** 软件而不是商业数据库产品。
- 关系模型不能很好地支持一些 **特定的查询** 操作。
- 对关系模型一些限制性感到沮丧，渴望更具 **动态和表达力** 的数据模型。

#### 1.2、文档模型

文档模型的数据结构例如 JSON、XML 或其二进制变体（如 MongoDB 的 BSON）。面向文档模型的数据库有：

- MongoDB
- RethinkDB
- CouchDB
- Espresso
- 等

> 关系数据库与文档数据库：支持文档数据模型主要论点是模型灵活，由于局部性而带来较好的性能，对于某些应用来说，它更接近于应用程序所使用的的数据结构。关系模型则强在联结操作、多对一和多对多关系更加简洁的表达上，与文档模型抗衡。

**当然，融合关系模型与文档模型，是未来数据库发展的一条很好的途径。**

#### 1.3、基于图的数据模型







### 2、数据查询语言







## 四、存储引擎与检索